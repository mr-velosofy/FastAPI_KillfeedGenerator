<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Killfeed Generator</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
  <link rel="manifest" href="/static/favicon/site.webmanifest">

</head>

<body>
  <div class="container">
    <h1>Killfeed Generator</h1>

    {% if error %}
    <div class="error-box">{{ error }}</div>
    {% endif %}

    <form method="post" novalidate onsubmit="return validateForm();">
      <div class="form-grid">
        <div class="form-group">
          <label>Killer Name</label>
          <input name="killer_name" id="killer_name" value="{{ form.killer_name }}">
          <div class="field-error" id="killer_name_error"></div>
        </div>

        <div class="form-group">
          <label>Victim Name</label>
          <input name="victim_name" id="victim_name" value="{{ form.victim_name }}">
          <div class="field-error" id="victim_name_error"></div>
        </div>

        <div class="form-group">
          <label>Killer Agent</label>
          <select name="killer_agent">
            {% for agent in agents %}
            <option value="{{ agent }}" {% if form.killer_agent==agent %}selected{% endif %}>{{ agent }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label>Victim Agent</label>
          <select name="victim_agent">
            {% for agent in agents %}
            <option value="{{ agent }}" {% if form.victim_agent==agent %}selected{% endif %}>{{ agent }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label>Weapon</label>
          <select name="weapon">
            {% for w in weapons %}
            <!-- remove "_weapon" or "_Weapon" from w in frontend where weapon exists else not -->
            <option value="{{ w }}" {% if form.weapon==w %}selected{% endif %}>{{ w[:-7] if w.endswith("_Weapon") or
              w.endswith("_weapon") else w }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label>Killcount (3â€“7 only)</label>
          <select name="numeral">
            <option value="">None</option>
            {% for n in ['3', '4', '5', '6', '7'] %}
            <option value="{{ n }}" {% if form.numeral==n %}selected{% endif %}>{{ n }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group toggles">
          <div class="toggle-option">
            <label class="switch">
              <input type="checkbox" name="is_headshot" {% if form.is_headshot %}checked{% endif %}>
              <span class="slider"></span>
            </label>
            <span>Headshot</span>
          </div>

          <div class="toggle-option">
            <label class="switch">
              <input type="checkbox" name="is_wallbang" {% if form.is_wallbang %}checked{% endif %}>
              <span class="slider"></span>
            </label>
            <span>Wallbang</span>
          </div>

          <div class="toggle-option">
            <label class="switch">
              <input type="checkbox" name="is_player_kill" {% if form.is_player_kill %}checked{% endif %}>
              <span class="slider"></span>
            </label>
            <span>Me Highlight</span>
          </div>
          <div class="toggle-option">
            <label class="switch">
              <input type="checkbox" name="is_enemy_kill" {% if form.is_enemy_kill %}checked{% endif %}>
              <span class="slider"></span>
            </label>
            <span>Enemy Kill</span>
          </div>
        </div>

        <button type="submit">Generate</button>
      </div>
    </form>

    {% if image_url %}
    <div class="preview">
      <h2>Preview</h2>
      <img src="{{ image_url }}" alt="Killfeed Image">
      <a href="/download/{{ image_filename }}"><button>Download Image</button></a>


    </div>
    {% endif %}
  </div>


  <script>
    function validateForm() {
      let valid = true;

      // Clear previous errors
      document.querySelectorAll(".field-error").forEach(el => el.innerText = "");

      // Get values
      const killerName = document.getElementById("killer_name").value.trim();
      const victimName = document.getElementById("victim_name").value.trim();

      // Validate killer name
      if (!killerName) {
        document.getElementById("killer_name_error").innerText = "Please enter a killer name.";
        valid = false;
      }

      // Validate victim name
      if (!victimName) {
        document.getElementById("victim_name_error").innerText = "Please enter a victim name.";
        valid = false;
      }

      return valid;
    }
  </script>

</body>

</html>